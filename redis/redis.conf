# Redis設定ファイル - PersonalCookingRecipe Phase 1最適化
# JWT キャッシング + API パフォーマンス向上

# =============================================================================
# 基本設定
# =============================================================================
bind 0.0.0.0
port 6379
timeout 300
tcp-keepalive 60

# =============================================================================
# セキュリティ設定
# =============================================================================
# requirepass は docker-compose.yml で設定
# protected-mode yes

# =============================================================================
# メモリ・パフォーマンス最適化
# =============================================================================
# 最大メモリ使用量 (256MB)
maxmemory 256mb
maxmemory-policy allkeys-lru

# スレッド数最適化
io-threads 4
io-threads-do-reads yes

# =============================================================================
# 永続化設定 (JWT用途なので軽量化)
# =============================================================================
# RDB snapshot (データ保護)
save 900 1
save 300 10
save 60 10000

# AOF無効化 (JWT キャッシングは復旧可能)
appendonly no

# =============================================================================
# 接続・パフォーマンス設定
# =============================================================================
# 最大接続数
maxclients 10000

# ログレベル
loglevel notice
logfile /var/log/redis/redis-server.log

# =============================================================================
# JWT キャッシング最適化
# =============================================================================
# Hash設定 (JWT payload 効率化)
hash-max-ziplist-entries 512
hash-max-ziplist-value 64

# TTL設定最適化
lazy-expire-keys yes

# =============================================================================
# 監視・デバッグ設定
# =============================================================================
# Slow log (100ms以上のクエリ)
slowlog-log-slower-than 100000
slowlog-max-len 128

# 統計情報有効化
latency-monitor-threshold 100