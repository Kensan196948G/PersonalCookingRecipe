# PersonalCookingRecipe システム要件定義書

## プロジェクト概要

### プロジェクト名
PersonalCookingRecipe - 3チャンネル統合レシピ監視システム

### バージョン
1.0.0

### 作成日
2025-08-07

### 目的
macOS環境でYouTube 3チャンネル（SAM THE COOKING GUY、Tasty Recipes、Joshua Weissman）の新しいレシピ動画を自動監視し、Claude AIによる解析・翻訳を行い、Notionデータベースに自動登録する完全自動化システムの構築。

---

## 1. 機能要件 (Functional Requirements)

### 1.1 コア機能

#### 1.1.1 YouTube動画監視機能
- **FR-001**: 指定された3チャンネルから新しい動画を自動検知する
- **FR-002**: 肉料理関連の動画をキーワードフィルタリングにより自動抽出する
- **FR-003**: 重複動画の検出と除去を行う
- **FR-004**: 24時間365日の自動監視を実現する

**監視対象チャンネル:**
- SAM THE COOKING GUY (UC8C7QblJwCHsYrftuLjGKig) - 優先度: 高
- Tasty Recipes (UCJFp8uSYCjXOMnkUyb3CQ3Q) - 優先度: 高  
- Joshua Weissman (UChBEbMKI1eCcejTtmI32UEw) - 優先度: 最高

#### 1.1.2 AI レシピ解析機能
- **FR-005**: Claude AIを使用した動画タイトル・説明文の自然言語解析
- **FR-006**: 英語から日本語への自動翻訳
- **FR-007**: レシピの構造化（材料・手順・調理時間・難易度）
- **FR-008**: チャンネル特性に応じた解析パターンの適用
- **FR-009**: 品質スコアの自動評価

#### 1.1.3 データベース連携機能
- **FR-010**: Notion APIを使用したページ自動生成
- **FR-011**: YouTube動画の自動埋め込み
- **FR-012**: 検索・フィルタリング可能な構造での保存
- **FR-013**: チャンネル別テンプレートの適用
- **FR-014**: レシピメタデータの構造化保存

#### 1.1.4 通知機能
- **FR-015**: 新レシピ登録のGmail通知送信
- **FR-016**: HTML形式の美しい通知メール生成
- **FR-017**: macOSネイティブ通知の表示
- **FR-018**: エラー・アラート通知の送信
- **FR-019**: 処理結果のサマリー通知

### 1.2 システム運用機能

#### 1.2.1 自動化機能
- **FR-020**: macOS LaunchDaemonによる自動実行
- **FR-021**: システム起動時の自動開始
- **FR-022**: 定期実行スケジューリング
- **FR-023**: プロセス監視と自動再起動

#### 1.2.2 設定管理機能
- **FR-024**: チャンネル設定の動的変更
- **FR-025**: 監視間隔の調整機能
- **FR-026**: フィルタリング条件の設定
- **FR-027**: 通知設定のカスタマイズ

#### 1.2.3 ログ・監視機能
- **FR-028**: 詳細な処理ログの記録
- **FR-029**: エラーログの分離記録
- **FR-030**: システムメトリクスの収集
- **FR-031**: ログローテーション機能

---

## 2. 非機能要件 (Non-Functional Requirements)

### 2.1 パフォーマンス要件

#### 2.1.1 処理性能
- **NFR-001**: 1動画あたりの処理時間は5分以内
- **NFR-002**: 同時処理可能動画数は最大5本
- **NFR-003**: システム応答時間は3秒以内
- **NFR-004**: API呼び出し成功率は95%以上

#### 2.1.2 リソース要件
- **NFR-005**: CPU使用率は平常時50%以下
- **NFR-006**: メモリ使用量は500MB以下
- **NFR-007**: ディスク使用量の増加は月1GB以下
- **NFR-008**: ネットワーク帯域は1Mbps以下

### 2.2 可用性要件
- **NFR-009**: システム稼働率は99.5%以上
- **NFR-010**: 平均故障間隔（MTBF）は720時間以上
- **NFR-011**: 平均復旧時間（MTTR）は30分以内
- **NFR-012**: 自動復旧機能の実装

### 2.3 セキュリティ要件
- **NFR-013**: macOS Keychainによる認証情報の安全な保存
- **NFR-014**: API通信のTLS暗号化
- **NFR-015**: 設定ファイルの暗号化
- **NFR-016**: アクセスログの記録と保護

### 2.4 保守性要件
- **NFR-017**: モジュール結合度の最小化
- **NFR-018**: 型ヒントによるコード品質向上
- **NFR-019**: 包括的テストカバレッジ（80%以上）
- **NFR-020**: 詳細な開発者ドキュメント

### 2.5 移植性・互換性要件
- **NFR-021**: macOS 12 (Monterey) 以降での動作保証
- **NFR-022**: Python 3.10以降での動作保証
- **NFR-023**: 他のmacOSバージョンへの移植可能性
- **NFR-024**: システム更新への対応

---

## 3. システム制約条件

### 3.1 技術制約
- **TC-001**: macOSでのみ動作する（Windows/Linux非対応）
- **TC-002**: YouTube Data API v3の利用制限に準拠
- **TC-003**: Claude APIの使用量制限に準拠
- **TC-004**: Notion APIのレート制限に準拠

### 3.2 運用制約
- **TC-005**: 1日の最大処理動画数は100本まで
- **TC-006**: 同時監視チャンネル数は3チャンネル固定
- **TC-007**: 1チャンネルあたり1時間に最大20動画まで
- **TC-008**: システム管理者による定期メンテナンス必須

### 3.3 法的制約
- **TC-009**: YouTube利用規約の遵守
- **TC-010**: 著作権法の遵守
- **TC-011**: データ保護規制の遵守
- **TC-012**: APIプロバイダ利用規約の遵守

---

## 4. インターフェース要件

### 4.1 外部システムインターフェース

#### 4.1.1 YouTube Data API v3
- **API仕様**: REST API v3
- **認証方式**: OAuth 2.0 または APIキー
- **使用エンドポイント**: 
  - `/channels` - チャンネル情報取得
  - `/search` - 動画検索
  - `/videos` - 動画詳細取得

#### 4.1.2 Claude API (Anthropic)
- **API仕様**: REST API
- **認証方式**: APIキー
- **モデル**: claude-3-haiku-20240307 (速度重視)
- **最大トークン**: 100,000トークン/リクエスト

#### 4.1.3 Notion API
- **API仕様**: REST API v1
- **認証方式**: OAuth 2.0
- **使用機能**: ページ作成、データベース更新、プロパティ設定

#### 4.1.4 Gmail API
- **API仕様**: REST API v1
- **認証方式**: OAuth 2.0
- **使用機能**: メール送信、HTML形式メール

### 4.2 内部システムインターフェース

#### 4.2.1 macOS Keychain
- **機能**: 認証情報の暗号化保存・取得
- **使用API**: Security Framework
- **キー管理**: サービス別暗号化キー

#### 4.2.2 LaunchDaemon
- **設定ファイル**: com.tasty.recipe.monitor.plist
- **実行間隔**: 1時間毎（カスタマイズ可能）
- **ログ出力**: StandardOutPath, StandardErrorPath

### 4.3 ユーザーインターフェース
- **UI-001**: コマンドラインインターフェース（CLI）
- **UI-002**: 設定ファイルベース設定
- **UI-003**: macOSネイティブ通知表示
- **UI-004**: ログファイルによる状況確認

---

## 5. データ要件

### 5.1 データモデル

#### 5.1.1 動画データ (VideoData)
```python
@dataclass
class VideoData:
    video_id: str           # YouTube動画ID
    title: str              # 動画タイトル
    description: str        # 動画説明
    channel_id: str         # チャンネルID
    channel_name: str       # チャンネル名
    published_at: datetime  # 公開日時
    duration: str           # 動画時間
    thumbnail_url: str      # サムネイルURL
    view_count: int         # 再生数
    like_count: int         # 高評価数
```

#### 5.1.2 レシピデータ (RecipeData)
```python
@dataclass
class RecipeData:
    recipe_id: str                    # 一意識別子
    source_video: VideoData           # 元動画データ
    title_ja: str                     # 日本語タイトル
    description_ja: str               # 日本語説明
    ingredients: List[str]            # 材料リスト
    instructions: List[str]           # 手順リスト
    cooking_time: str                 # 調理時間
    difficulty: int                   # 難易度（1-5）
    tags: List[str]                   # タグリスト
    quality_score: float              # 品質スコア
    processed_at: datetime            # 処理日時
```

### 5.2 データ保存要件
- **DR-001**: JSON形式での構造化データ保存
- **DR-002**: 処理済み動画リストのキャッシュ保存
- **DR-003**: エラー動画リストの記録
- **DR-004**: メトリクス情報の蓄積

### 5.3 データ保持要件
- **DR-005**: 処理済みデータの6か月間保持
- **DR-006**: エラーログの3か月間保持
- **DR-007**: メトリクスデータの1年間保持
- **DR-008**: 自動的なデータアーカイブ機能

---

## 6. セキュリティ要件

### 6.1 認証・認可
- **SEC-001**: macOS Keychainによる認証情報管理
- **SEC-002**: API認証情報の暗号化保存
- **SEC-003**: サービスアカウントでの実行
- **SEC-004**: ファイルアクセス権限の最小化

### 6.2 データ保護
- **SEC-005**: 設定ファイルの暗号化
- **SEC-006**: ログファイルの機密情報マスキング
- **SEC-007**: 一時ファイルの自動削除
- **SEC-008**: ネットワーク通信の暗号化

### 6.3 監査・ログ
- **SEC-009**: 全API呼び出しのログ記録
- **SEC-010**: 設定変更の監査ログ
- **SEC-011**: エラー発生時の詳細ログ
- **SEC-012**: セキュリティイベントの通知

---

## 7. 運用要件

### 7.1 インストール・セットアップ
- **OPS-001**: 自動インストールスクリプトの提供
- **OPS-002**: 依存関係の自動解決
- **OPS-003**: Keychain設定の自動化
- **OPS-004**: LaunchDaemon設定の自動化

### 7.2 監視・保守
- **OPS-005**: システムヘルスチェック機能
- **OPS-006**: 自動ログローテーション
- **OPS-007**: パフォーマンス監視
- **OPS-008**: 定期バックアップ機能

### 7.3 トラブルシューティング
- **OPS-009**: 詳細なエラーメッセージ
- **OPS-010**: 診断情報の自動収集
- **OPS-011**: リカバリ手順のドキュメント化
- **OPS-012**: サポートツールの提供

---

## 8. 品質要件

### 8.1 テスト要件
- **QA-001**: 単体テストカバレッジ80%以上
- **QA-002**: 統合テストの実装
- **QA-003**: API接続テストの自動化
- **QA-004**: パフォーマンステストの実行

### 8.2 コード品質
- **QA-005**: PEP 8準拠のコーディング規約
- **QA-006**: 型ヒントの完全実装
- **QA-007**: docstringによるドキュメント化
- **QA-008**: 静的コード解析の実施

---

## 9. 制約事項とリスク

### 9.1 技術的制約
1. **YouTube API制限**: 1日あたりのクォータ制限
2. **Claude API制限**: 使用料金とレート制限
3. **macOS依存**: 他OSでの動作不可
4. **ネットワーク依存**: インターネット接続必須

### 9.2 運用リスク
1. **API仕様変更**: 外部API仕様変更への対応
2. **サービス停止**: 外部サービス停止時の影響
3. **著作権問題**: コンテンツ使用に関する法的リスク
4. **データ損失**: システム障害によるデータ損失

### 9.3 リスク軽減策
1. **冗長化**: 複数APIエンドポイントの使用
2. **エラーハンドリング**: 堅牢なエラー処理の実装
3. **バックアップ**: 定期的なデータバックアップ
4. **監視**: 24/7システム監視の実装

---

## 10. 受入基準

### 10.1 機能受入基準
- [ ] 3チャンネル全てからの動画取得が正常に動作する
- [ ] Claude AIによる解析結果が期待する品質を満たす
- [ ] Notionページが正しいフォーマットで作成される
- [ ] Gmail通知が適切に送信される
- [ ] macOS通知が正常に表示される

### 10.2 性能受入基準
- [ ] 1動画の処理時間が5分以内
- [ ] システム稼働率が99%以上
- [ ] メモリ使用量が500MB以下
- [ ] API成功率が95%以上

### 10.3 運用受入基準
- [ ] LaunchDaemonが正常に動作する
- [ ] 自動インストールが正常に完了する
- [ ] ヘルスチェックが正常に動作する
- [ ] ログが適切に出力される

---

## 11. 今後の拡張予定

### 11.1 短期的拡張 (3ヶ月以内)
1. **追加チャンネル対応**: 新しいYouTubeチャンネルの追加
2. **フィルタ改善**: より精密な肉料理フィルタリング
3. **UI改善**: Web管理画面の追加
4. **分析機能**: レシピトレンド分析

### 11.2 中期的拡張 (6ヶ月以内)
1. **AI機能強化**: より高精度なレシピ解析
2. **多言語対応**: 他言語からの翻訳対応
3. **レシピ推奨**: ユーザー向けレシピ推奨機能
4. **データ可視化**: ダッシュボード機能

### 11.3 長期的拡張 (1年以内)
1. **モバイルアプリ**: iOS/Androidアプリ開発
2. **機械学習**: レシピ品質予測モデル
3. **コミュニティ機能**: ユーザー間での共有機能
4. **商用化**: SaaS化への発展

---

**文書承認**
- 作成者: Recipe-CTO Agent
- レビュー: 未実施
- 承認: 未実施
- 版数: 1.0
- 最終更新: 2025-08-07