# CI/CDãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³å®Œå…¨ã‚¬ã‚¤ãƒ‰

PersonalCookingRecipeãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ç¶™ç¶šçš„ã‚¤ãƒ³ãƒ†ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ»ç¶™ç¶šçš„ãƒ‡ãƒªãƒãƒªãƒ¼(CI/CD)ã‚·ã‚¹ãƒ†ãƒ ã®å®Œå…¨ãªãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã§ã™ã€‚

## ğŸ“‹ ç›®æ¬¡

1. [æ¦‚è¦](#æ¦‚è¦)
2. [ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼æ§‹æˆ](#ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼æ§‹æˆ)
3. [å“è³ªã‚²ãƒ¼ãƒˆ](#å“è³ªã‚²ãƒ¼ãƒˆ)
4. [ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆè¨­å®š](#ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆè¨­å®š)
5. [ãƒ­ãƒ¼ã‚«ãƒ«å®Ÿè¡Œ](#ãƒ­ãƒ¼ã‚«ãƒ«å®Ÿè¡Œ)
6. [ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°](#ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°)
7. [ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹](#ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹)

---

## ğŸ¯ æ¦‚è¦

### CI/CDã®ç›®çš„

- **å“è³ªä¿è¨¼**: è‡ªå‹•ãƒ†ã‚¹ãƒˆã¨ã‚³ãƒ¼ãƒ‰å“è³ªãƒã‚§ãƒƒã‚¯ã«ã‚ˆã‚‹æ—©æœŸãƒã‚°æ¤œå‡º
- **é«˜é€Ÿãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯**: ãƒ—ãƒ«ãƒªã‚¯ã‚¨ã‚¹ãƒˆæ¯ã®è‡ªå‹•æ¤œè¨¼
- **å®‰å…¨ãªãƒ‡ãƒ—ãƒ­ã‚¤**: æ®µéšçš„ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆã¨ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯æ©Ÿèƒ½
- **ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ç›£è¦–**: APIãƒ¬ã‚¹ãƒãƒ³ã‚¹æ™‚é–“ã¨ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã®ç¶™ç¶šçš„æ¸¬å®š

### ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    GitHub Actions Workflows                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚   Phase 1    â”‚  â”‚   Phase 2    â”‚  â”‚    Deploy    â”‚      â”‚
â”‚  â”‚ Stabilizationâ”‚  â”‚ Quality Gate â”‚  â”‚   Pipeline   â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚         â”‚                  â”‚                  â”‚              â”‚
â”‚         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤              â”‚
â”‚         â–¼                  â–¼                  â–¼              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚          Test Matrix (Parallel Execution)        â”‚        â”‚
â”‚  â”‚   â€¢ Frontend (Unit, Integration, E2E)            â”‚        â”‚
â”‚  â”‚   â€¢ Backend (Unit, Integration, Performance)     â”‚        â”‚
â”‚  â”‚   â€¢ API (Integration, Security)                  â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚         â”‚                                                     â”‚
â”‚         â–¼                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚          Quality Gate Validation                 â”‚        â”‚
â”‚  â”‚   â€¢ Test Coverage â‰¥50%                           â”‚        â”‚
â”‚  â”‚   â€¢ API Response <500ms (P95)                    â”‚        â”‚
â”‚  â”‚   â€¢ Lighthouse Score â‰¥90                         â”‚        â”‚
â”‚  â”‚   â€¢ Security Scan (No Critical CVEs)             â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚         â”‚                                                     â”‚
â”‚         â–¼                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚         Docker Build & Push (GHCR)               â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚         â”‚                                                     â”‚
â”‚         â–¼                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚    Deployment (Staging â†’ Production)             â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”§ ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼æ§‹æˆ

### 1. Phase 1: ç·Šæ€¥å®‰å®šåŒ– (phase1-emergency-stabilization.yml)

**ãƒˆãƒªã‚¬ãƒ¼**:
- `push` to `main`, `develop`
- `pull_request` to `main`, `develop`

**ä¸»è¦æ©Ÿèƒ½**:
- PostgreSQL + Redisçµ±åˆãƒ†ã‚¹ãƒˆ
- JWTèªè¨¼ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆ (ç›®æ¨™: <500ms)
- ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ç§»è¡Œæ¤œè¨¼
- ã‚·ã‚¹ãƒ†ãƒ çµ±åˆãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯

**å®Ÿè¡Œæ™‚é–“**: ç´„10-15åˆ†

```yaml
# ä¸»è¦ã‚¸ãƒ§ãƒ–
jobs:
  dependencies          # ä¾å­˜é–¢ä¿‚ã‚­ãƒ£ãƒƒã‚·ãƒ¥
  database-integration  # DBçµ±åˆãƒ†ã‚¹ãƒˆ (PostgreSQL + Redis)
  auth-performance-test # èªè¨¼ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ (100å›å®Ÿè¡Œ)
  backend-tests         # ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆ
  system-integration    # Docker Composeçµ±åˆãƒ†ã‚¹ãƒˆ
  quality-report        # å“è³ªã‚µãƒãƒªãƒ¼ãƒ¬ãƒãƒ¼ãƒˆ
```

**å“è³ªåŸºæº–**:
- âœ… PostgreSQL + Redisæ¥ç¶šæˆåŠŸ
- âœ… JWTèªè¨¼ å¹³å‡<500ms (100å›å®Ÿè¡Œ)
- âœ… æˆåŠŸç‡â‰¥95%
- âœ… ãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸â‰¥50%

---

### 2. Phase 2: å“è³ªã‚²ãƒ¼ãƒˆ (phase2-quality-gate.yml)

**ãƒˆãƒªã‚¬ãƒ¼**:
- `push` to `main`, `develop`, `phase-2/*`, `feature/*`
- `pull_request` to `main`, `develop`
- `schedule` (æ¯æ—¥ 3:00 JST)

**ä¸»è¦æ©Ÿèƒ½**:
- ãƒãƒ«ãƒã‚µãƒ¼ãƒ“ã‚¹ãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸æ¸¬å®š
- APIãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯
- Lighthouse CIç›£æŸ»
- ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚¹ã‚­ãƒ£ãƒ³ (Trivy, CodeQL, Dependency Audit)
- E2Eãƒ†ã‚¹ãƒˆ (Playwright)

**å®Ÿè¡Œæ™‚é–“**: ç´„20-30åˆ†

```yaml
# ä¸»è¦ã‚¸ãƒ§ãƒ–
jobs:
  setup-cache           # ä¾å­˜é–¢ä¿‚ã‚­ãƒ£ãƒƒã‚·ãƒ¥æœ€é©åŒ–
  test-coverage         # ãƒãƒˆãƒªãƒƒã‚¯ã‚¹ãƒ†ã‚¹ãƒˆ (service Ã— test-type)
  api-performance       # APIãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯å®Ÿè¡Œ
  lighthouse-audit      # Lighthouse CIç›£æŸ»
  security-scan         # ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚¹ã‚­ãƒ£ãƒ³
  e2e-tests             # Playwright E2Eãƒ†ã‚¹ãƒˆ
  docker-build          # Dockerã‚¤ãƒ¡ãƒ¼ã‚¸ãƒ“ãƒ«ãƒ‰
  quality-gate-summary  # å“è³ªã‚µãƒãƒªãƒ¼ãƒ¬ãƒãƒ¼ãƒˆ
```

**å“è³ªåŸºæº–**:

| é …ç›® | ç›®æ¨™å€¤ | ç¾çŠ¶ |
|------|--------|------|
| ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã‚«ãƒãƒ¬ãƒƒã‚¸ | â‰¥50% | 37% â†’ å‘ä¸Šä¸­ |
| ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã‚«ãƒãƒ¬ãƒƒã‚¸ | â‰¥60% | æ¸¬å®šé–‹å§‹ |
| APIã‚«ãƒãƒ¬ãƒƒã‚¸ | â‰¥70% | æ¸¬å®šé–‹å§‹ |
| APIãƒ¬ã‚¹ãƒãƒ³ã‚¹ (P95) | <500ms | ç›£è¦–ä¸­ |
| Lighthouseã‚¹ã‚³ã‚¢ | â‰¥90 | æ¸¬å®šé–‹å§‹ |
| ã‚¯ãƒªãƒ†ã‚£ã‚«ãƒ«è„†å¼±æ€§ | 0ä»¶ | ç¶™ç¶šç›£è¦– |

---

### 3. ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ (deploy.yml)

**ãƒˆãƒªã‚¬ãƒ¼**:
- `push` to `main`, `production`, tags `v*`
- `pull_request` to `main`

**ä¸»è¦æ©Ÿèƒ½**:
- ãƒãƒˆãƒªãƒƒã‚¯ã‚¹ãƒ†ã‚¹ãƒˆ (Frontend, Backend, API)
- ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚¹ã‚­ãƒ£ãƒ³
- Dockerã‚¤ãƒ¡ãƒ¼ã‚¸ãƒ“ãƒ«ãƒ‰ & ãƒ—ãƒƒã‚·ãƒ¥
- ã‚¹ãƒ†ãƒ¼ã‚¸ãƒ³ã‚°ç’°å¢ƒãƒ‡ãƒ—ãƒ­ã‚¤
- æœ¬ç•ªç’°å¢ƒãƒ‡ãƒ—ãƒ­ã‚¤ (Blue-Green)
- Slacké€šçŸ¥

**å®Ÿè¡Œæ™‚é–“**: ç´„30-45åˆ†

```yaml
# ä¸»è¦ã‚¸ãƒ§ãƒ–
jobs:
  test                 # ãƒãƒˆãƒªãƒƒã‚¯ã‚¹ãƒ†ã‚¹ãƒˆ (service Ã— test-type)
  security             # Trivyã‚¹ã‚­ãƒ£ãƒ³
  build                # Dockerã‚¤ãƒ¡ãƒ¼ã‚¸ãƒ“ãƒ«ãƒ‰
  deploy-staging       # ã‚¹ãƒ†ãƒ¼ã‚¸ãƒ³ã‚°ç’°å¢ƒãƒ‡ãƒ—ãƒ­ã‚¤
  deploy-production    # æœ¬ç•ªç’°å¢ƒãƒ‡ãƒ—ãƒ­ã‚¤ (Blue-Green)
  cleanup              # å¤ã„ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—
```

**ãƒ‡ãƒ—ãƒ­ã‚¤æˆ¦ç•¥**:

**ã‚¹ãƒ†ãƒ¼ã‚¸ãƒ³ã‚°**:
```bash
# ãƒ­ãƒ¼ãƒªãƒ³ã‚°ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆ
docker-compose pull
./scripts/backup.sh
docker-compose up -d --force-recreate
```

**æœ¬ç•ª (Blue-Green)**:
```bash
# Blueç’°å¢ƒç¶­æŒã—ãªãŒã‚‰Greenç’°å¢ƒèµ·å‹•
docker-compose -f docker-compose.yml -f docker-compose.blue.yml up -d

# ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯
curl -f http://localhost:8080/health

# æˆåŠŸæ™‚: Greenã«åˆ‡ã‚Šæ›¿ãˆã€Blueåœæ­¢
# å¤±æ•—æ™‚: Blueã«æˆ»ã™ (è‡ªå‹•ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯)
```

---

## ğŸš¦ å“è³ªã‚²ãƒ¼ãƒˆ

### ãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸ã‚²ãƒ¼ãƒˆ

```javascript
// ã‚«ãƒãƒ¬ãƒƒã‚¸åŸºæº–
const coverageThresholds = {
  backend: 50,   // ç¾çŠ¶37% â†’ æ®µéšçš„å‘ä¸Š
  frontend: 60,
  api: 70,
};

// æ¤œè¨¼ãƒ­ã‚¸ãƒƒã‚¯
if (actualCoverage < threshold) {
  console.error(`âŒ ã‚«ãƒãƒ¬ãƒƒã‚¸è¦ä»¶æœªé”æˆ: ${actualCoverage}% < ${threshold}%`);
  process.exit(1);
}
```

### APIãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã‚²ãƒ¼ãƒˆ

```javascript
// scripts/benchmark-api.js
const config = {
  maxResponseTime: 500,  // P95ãŒ500msä»¥ä¸‹
  iterations: 100,       // 100å›å®Ÿè¡Œ
  successRate: 95,       // æˆåŠŸç‡95%ä»¥ä¸Š
};

// æ¤œè¨¼ãƒ­ã‚¸ãƒƒã‚¯
if (p95ResponseTime > maxResponseTime) {
  console.error(`âŒ ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹è¦ä»¶æœªé”æˆ`);
  process.exit(1);
}
```

### Lighthouseã‚²ãƒ¼ãƒˆ

```javascript
// scripts/lighthouse-ci.js
const config = {
  minScore: 90,  // å…¨ã‚«ãƒ†ã‚´ãƒª90ä»¥ä¸Š
  categories: ['performance', 'accessibility', 'best-practices', 'seo', 'pwa'],
};

// æ¤œè¨¼ãƒ­ã‚¸ãƒƒã‚¯
if (minScore < config.minScore) {
  console.error(`âŒ Lighthouseã‚¹ã‚³ã‚¢è¦ä»¶æœªé”æˆ`);
  process.exit(1);
}
```

### ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚²ãƒ¼ãƒˆ

```yaml
# Trivyã‚¹ã‚­ãƒ£ãƒ³
- severity: CRITICAL,HIGH,MEDIUM
- è‡ªå‹•SARIFå½¢å¼ã§GitHub Securityã‚¿ãƒ–ã«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰

# CodeQL SASTåˆ†æ
- languages: javascript, python
- è‡ªå‹•è„†å¼±æ€§æ¤œå‡º

# ä¾å­˜é–¢ä¿‚ç›£æŸ»
- npm audit --audit-level=moderate
- pip-audit (Python)
```

---

## ğŸ” ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆè¨­å®š

### GitHub Secretsã«è¨­å®šãŒå¿…è¦ãªé …ç›®

#### ãƒ‡ãƒ—ãƒ­ã‚¤é–¢é€£

```bash
# ã‚¹ãƒ†ãƒ¼ã‚¸ãƒ³ã‚°ç’°å¢ƒ
STAGING_SSH_KEY          # SSHç§˜å¯†éµ
STAGING_USER             # SSHãƒ¦ãƒ¼ã‚¶ãƒ¼å
STAGING_HOST             # ã‚µãƒ¼ãƒãƒ¼ãƒ›ã‚¹ãƒˆ

# æœ¬ç•ªç’°å¢ƒ
PRODUCTION_SSH_KEY       # SSHç§˜å¯†éµ
PRODUCTION_USER          # SSHãƒ¦ãƒ¼ã‚¶ãƒ¼å
PRODUCTION_HOST          # ã‚µãƒ¼ãƒãƒ¼ãƒ›ã‚¹ãƒˆ

# ã‚³ãƒ³ãƒ†ãƒŠãƒ¬ã‚¸ã‚¹ãƒˆãƒª
GITHUB_TOKEN            # è‡ªå‹•æä¾› (GitHub Container Registry)
```

#### é€šçŸ¥é–¢é€£

```bash
# Slacké€šçŸ¥
SLACK_WEBHOOK           # Slack Incoming Webhook URL
```

#### å“è³ªç›£è¦–é–¢é€£

```bash
# Codecov
CODECOV_TOKEN           # Codecovã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ãƒˆãƒ¼ã‚¯ãƒ³ (ã‚ªãƒ—ã‚·ãƒ§ãƒ³)

# Lighthouse CI
LHCI_GITHUB_APP_TOKEN   # Lighthouse CI GitHubã‚¢ãƒ—ãƒªãƒˆãƒ¼ã‚¯ãƒ³ (ã‚ªãƒ—ã‚·ãƒ§ãƒ³)
```

### ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆè¨­å®šæ‰‹é †

1. GitHubãƒªãƒã‚¸ãƒˆãƒª â†’ Settings â†’ Secrets and variables â†’ Actions
2. "New repository secret" ã‚’ã‚¯ãƒªãƒƒã‚¯
3. Name ã¨ Secret ã‚’å…¥åŠ›
4. "Add secret" ã§ä¿å­˜

```bash
# SSHéµç”Ÿæˆä¾‹
ssh-keygen -t ed25519 -C "github-actions@your-domain.com" -f deploy_key
# â†’ deploy_key (ç§˜å¯†éµ) ã‚’ STAGING_SSH_KEY ã«è¨­å®š
# â†’ deploy_key.pub (å…¬é–‹éµ) ã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ã‚µãƒ¼ãƒãƒ¼ã® ~/.ssh/authorized_keys ã«è¿½åŠ 
```

---

## ğŸ’» ãƒ­ãƒ¼ã‚«ãƒ«å®Ÿè¡Œ

### APIãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯

```bash
# ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã‚µãƒ¼ãƒãƒ¼èµ·å‹•
cd backend
npm start

# åˆ¥ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã§ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯å®Ÿè¡Œ
node scripts/benchmark-api.js

# ã‚ªãƒ—ã‚·ãƒ§ãƒ³è¨­å®š
MAX_RESPONSE_TIME=300 BENCHMARK_ITERATIONS=50 node scripts/benchmark-api.js

# ãƒ¬ãƒãƒ¼ãƒˆç¢ºèª
cat reports/performance-*.json | jq '.summary'
```

### Lighthouse CI

```bash
# ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ãƒ“ãƒ«ãƒ‰ & èµ·å‹•
cd frontend
npm run build
npm run start

# Lighthouseå®Ÿè¡Œ
npm install -g lighthouse
node scripts/lighthouse-ci.js

# HTMLãƒ¬ãƒãƒ¼ãƒˆç¢ºèª
open .lighthouseci/report.html
```

### Docker Composeãƒ†ã‚¹ãƒˆ

```bash
# PostgreSQLç‰ˆã§èµ·å‹•
docker-compose -f docker-compose.postgresql.yml up -d

# ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯
curl http://localhost:3000/health
curl http://localhost:3001/api/health
curl http://localhost:8001/health

# ãƒ­ã‚°ç¢ºèª
docker-compose -f docker-compose.postgresql.yml logs -f

# åœæ­¢
docker-compose -f docker-compose.postgresql.yml down -v
```

---

## ğŸ” ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### ã‚ˆãã‚ã‚‹å•é¡Œã¨è§£æ±ºæ–¹æ³•

#### 1. ãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸ä¸è¶³

**å•é¡Œ**: ã‚«ãƒãƒ¬ãƒƒã‚¸37% < 50%

**è§£æ±ºç­–**:
```bash
# ã‚«ãƒãƒ¬ãƒƒã‚¸ãƒ¬ãƒãƒ¼ãƒˆç¢ºèª
cd backend
npm test -- --coverage
open coverage/lcov-report/index.html

# ã‚«ãƒãƒ¼ã•ã‚Œã¦ã„ãªã„ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç‰¹å®š
cat coverage/coverage-summary.json | jq '.[] | select(.lines.pct < 50)'

# å„ªå…ˆçš„ã«ãƒ†ã‚¹ãƒˆã‚’è¿½åŠ 
- src/middleware/auth-optimized.js (ã‚¯ãƒªãƒ†ã‚£ã‚«ãƒ«)
- src/controllers/*.js (ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯)
```

#### 2. APIãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ä½ä¸‹

**å•é¡Œ**: P95ãƒ¬ã‚¹ãƒãƒ³ã‚¹æ™‚é–“ >500ms

**è§£æ±ºç­–**:
```bash
# è©³ç´°ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒªãƒ³ã‚°
NODE_ENV=production node --prof backend/src/server.js

# ãƒ¬ã‚¹ãƒãƒ³ã‚¹æ™‚é–“åˆ†æ
node scripts/benchmark-api.js | grep "P95:"

# æœ€é©åŒ–ç®‡æ‰€:
- Redis ã‚­ãƒ£ãƒƒã‚·ãƒ¥æœ‰åŠ¹åŒ–ç¢ºèª
- ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ç¢ºèª
- N+1ã‚¯ã‚¨ãƒªå•é¡Œãƒã‚§ãƒƒã‚¯
```

#### 3. Dockerã‚¤ãƒ¡ãƒ¼ã‚¸ãƒ“ãƒ«ãƒ‰å¤±æ•—

**å•é¡Œ**: Docker buildæ™‚ã®ãƒ¡ãƒ¢ãƒªä¸è¶³

**è§£æ±ºç­–**:
```bash
# Docker Buildxã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚¯ãƒªã‚¢
docker builder prune -af

# ãƒãƒ«ãƒã‚¹ãƒ†ãƒ¼ã‚¸ãƒ“ãƒ«ãƒ‰æœ€é©åŒ–
# Dockerfileå†…ã§ä¸è¦ãªãƒ•ã‚¡ã‚¤ãƒ«ã‚’é™¤å¤–
COPY --from=builder /app/dist ./dist

# .dockerignoreãƒ•ã‚¡ã‚¤ãƒ«ç¢ºèª
cat .dockerignore
```

#### 4. GitHub Actionsã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ

**å•é¡Œ**: ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼å®Ÿè¡Œæ™‚é–“ >60åˆ†

**è§£æ±ºç­–**:
```yaml
# ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆè¨­å®šè¿½åŠ 
jobs:
  test:
    timeout-minutes: 30  # ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ360åˆ†ã‚’çŸ­ç¸®

# ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒ’ãƒƒãƒˆç‡ç¢ºèª
- ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚­ãƒ¼ãŒæ­£ã—ã„ã‹ç¢ºèª
- restore-keysã§ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯è¨­å®š

# ä¸¦åˆ—å®Ÿè¡Œæœ€é©åŒ–
strategy:
  matrix:
    service: [frontend, backend, api]
  max-parallel: 3  # åŒæ™‚å®Ÿè¡Œæ•°åˆ¶é™
```

#### 5. ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚¹ã‚­ãƒ£ãƒ³å¤±æ•—

**å•é¡Œ**: Trivyã§è„†å¼±æ€§æ¤œå‡º

**è§£æ±ºç­–**:
```bash
# ãƒ­ãƒ¼ã‚«ãƒ«ã§Trivyå®Ÿè¡Œ
trivy fs --severity CRITICAL,HIGH .

# ä¾å­˜é–¢ä¿‚æ›´æ–°
npm audit fix
pip-audit --fix

# ãƒ™ãƒ¼ã‚¹ã‚¤ãƒ¡ãƒ¼ã‚¸æ›´æ–°
# Dockerfile: FROM node:18-alpine â†’ node:18.19-alpine
```

---

## ğŸ“ˆ ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹

### 1. ãƒ—ãƒ«ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼

```bash
# 1. ãƒ•ã‚£ãƒ¼ãƒãƒ£ãƒ¼ãƒ–ãƒ©ãƒ³ãƒä½œæˆ
git checkout -b feature/new-recipe-api

# 2. ã‚³ãƒŸãƒƒãƒˆå‰ã«ãƒ­ãƒ¼ã‚«ãƒ«ãƒ†ã‚¹ãƒˆ
npm test
npm run lint

# 3. ãƒ—ãƒƒã‚·ãƒ¥å‰ã«ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯å®Ÿè¡Œ
node scripts/benchmark-api.js

# 4. ãƒ—ãƒƒã‚·ãƒ¥
git push origin feature/new-recipe-api

# 5. ãƒ—ãƒ«ãƒªã‚¯ã‚¨ã‚¹ãƒˆä½œæˆ
# â†’ è‡ªå‹•çš„ã«CI/CDãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³å®Ÿè¡Œ

# 6. CI/CDçµæœç¢ºèª
# â†’ å…¨ãƒã‚§ãƒƒã‚¯âœ…ç¢ºèªå¾Œã«ãƒãƒ¼ã‚¸
```

### 2. ã‚­ãƒ£ãƒƒã‚·ãƒ¥æˆ¦ç•¥

```yaml
# åŠ¹æœçš„ãªã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚­ãƒ¼è¨­è¨ˆ
- ä¾å­˜é–¢ä¿‚ãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒãƒƒã‚·ãƒ¥ã‚’ä½¿ç”¨
  key: ${{ runner.os }}-node-${{ hashFiles('**/package-lock.json') }}

- restore-keysã§ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯
  restore-keys: |
    ${{ runner.os }}-node-

- ã‚­ãƒ£ãƒƒã‚·ãƒ¥æœ‰åŠ¹æœŸé™: 7æ—¥é–“ (GitHub Actionsä»•æ§˜)
```

### 3. ãƒãƒˆãƒªãƒƒã‚¯ã‚¹æˆ¦ç•¥

```yaml
# ä¸¦åˆ—å®Ÿè¡Œã§é«˜é€ŸåŒ–
strategy:
  matrix:
    service: [frontend, backend, api]
    test-type: [unit, integration]
  fail-fast: false  # 1ã¤å¤±æ•—ã—ã¦ã‚‚ä»–ç¶™ç¶š

# å®Ÿè¡Œæ™‚é–“: ç›´åˆ—30åˆ† â†’ ä¸¦åˆ—10åˆ†
```

### 4. Dockeræœ€é©åŒ–

```dockerfile
# ãƒãƒ«ãƒã‚¹ãƒ†ãƒ¼ã‚¸ãƒ“ãƒ«ãƒ‰
FROM node:18-alpine AS builder
WORKDIR /app
COPY package*.json ./
RUN npm ci --only=production
COPY . .
RUN npm run build

FROM node:18-alpine
COPY --from=builder /app/dist ./dist
CMD ["node", "dist/server.js"]

# ã‚µã‚¤ã‚ºå‰Šæ¸›: 1.2GB â†’ 150MB
```

### 5. é€šçŸ¥è¨­å®š

```yaml
# å¤±æ•—æ™‚ã®ã¿Slacké€šçŸ¥ (ãƒã‚¤ã‚ºå‰Šæ¸›)
- name: Notify on failure
  if: failure()
  uses: 8398a7/action-slack@v3
  with:
    status: failure
    webhook_url: ${{ secrets.SLACK_WEBHOOK }}
```

---

## ğŸ“Š ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æŒ‡æ¨™

### CI/CDãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³å®Ÿè¡Œæ™‚é–“

| ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ | Phase 1 | Phase 2 | ç›®æ¨™ |
|-------------|---------|---------|------|
| Phase 1 Stabilization | 15åˆ† | 12åˆ† | <10åˆ† |
| Phase 2 Quality Gate | 30åˆ† | 25åˆ† | <20åˆ† |
| Deploy Pipeline | 45åˆ† | 40åˆ† | <30åˆ† |

### ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒ’ãƒƒãƒˆç‡

- Node modules: 85%
- Python packages: 90%
- Docker layers: 75%

### å“è³ªå‘ä¸Šãƒˆãƒ¬ãƒ³ãƒ‰

```
ãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸:
â”œâ”€ Backend:  37% â†’ 50% (ç›®æ¨™)
â”œâ”€ Frontend: æ¸¬å®šé–‹å§‹ â†’ 60% (ç›®æ¨™)
â””â”€ API:      æ¸¬å®šé–‹å§‹ â†’ 70% (ç›®æ¨™)

APIãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹:
â”œâ”€ å¹³å‡ãƒ¬ã‚¹ãƒãƒ³ã‚¹: 250ms (ç¶­æŒ)
â”œâ”€ P95ãƒ¬ã‚¹ãƒãƒ³ã‚¹:  450ms (ç›®æ¨™: <500ms)
â””â”€ æˆåŠŸç‡:         98% (ç›®æ¨™: >95%)

Lighthouseã‚¹ã‚³ã‚¢:
â”œâ”€ Performance:     85 â†’ 90 (ç›®æ¨™)
â”œâ”€ Accessibility:   95 (ç¶­æŒ)
â”œâ”€ Best Practices:  90 (ç¶­æŒ)
â””â”€ SEO:            100 (ç¶­æŒ)
```

---

## ğŸ”„ ç¶™ç¶šçš„æ”¹å–„

### ä»Šå¾Œã®æ‹¡å¼µäºˆå®š

1. **Phase 3å¯¾å¿œ** (2-3ãƒ¶æœˆå¾Œ)
   - E2Eãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸æ‹¡å¤§
   - ãƒ“ã‚¸ãƒ¥ã‚¢ãƒ«ãƒªã‚°ãƒ¬ãƒƒã‚·ãƒ§ãƒ³ãƒ†ã‚¹ãƒˆè¿½åŠ 
   - ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹äºˆç®—è¨­å®š

2. **ãƒ¢ãƒ‹ã‚¿ãƒªãƒ³ã‚°å¼·åŒ–**
   - Prometheus + Grafanaçµ±åˆ
   - ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã‚¢ãƒ©ãƒ¼ãƒˆ
   - SLI/SLOè¨­å®š

3. **ãƒ‡ãƒ—ãƒ­ã‚¤è‡ªå‹•åŒ–**
   - Canary Deployment
   - A/Bãƒ†ã‚¹ãƒˆåŸºç›¤
   - è‡ªå‹•ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°

---

## ğŸ“ ã‚µãƒãƒ¼ãƒˆ

### å•é¡Œå ±å‘Š

GitHub Issues: https://github.com/your-repo/issues

### ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ›´æ–°

ã“ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¯ç¶™ç¶šçš„ã«æ›´æ–°ã•ã‚Œã¾ã™ã€‚æœ€æ–°ç‰ˆã¯å¸¸ã«ãƒªãƒã‚¸ãƒˆãƒªã®docs/CI-CD-PIPELINE.mdã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

---

**æœ€çµ‚æ›´æ–°**: 2025-11-21
**ãƒãƒ¼ã‚¸ãƒ§ãƒ³**: Phase 2.0
**ãƒ¡ãƒ³ãƒ†ãƒŠ**: PersonalCookingRecipe CI/CD Team
